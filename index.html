<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Live Bus Times - Cleveland Centre Bus Stops</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, #1e3c72 0%, #2a5298 100%);
            color: white;
            height: 100vh;
            overflow: hidden;
            padding: 30px;
        }

        .container {
            height: 100%;
            display: flex;
            flex-direction: column;
            max-width: 1200px;
            margin: 0 auto;
        }

        .next-bus-banner {
            background: rgba(74, 222, 128, 0.2);
            border: 2px solid #4ade80;
            border-radius: 20px;
            padding: 25px;
            text-align: center;
            margin-bottom: 30px;
            backdrop-filter: blur(10px);
            box-shadow: 0 8px 32px rgba(74, 222, 128, 0.1);
        }

        .next-bus-title {
            font-size: 1.8rem;
            color: #4ade80;
            margin-bottom: 10px;
            font-weight: 300;
        }

        .next-bus-time {
            font-size: 4rem;
            font-weight: bold;
            color: #4ade80;
            text-shadow: 0 2px 10px rgba(74, 222, 128, 0.3);
            margin-bottom: 5px;
        }

        .next-bus-route {
            font-size: 1.5rem;
            opacity: 0.9;
        }

        .header {
            text-align: center;
            margin-bottom: 30px;
            border-bottom: 3px solid rgba(255, 255, 255, 0.3);
            padding-bottom: 25px;
            position: relative;
        }

        .stop-name {
            font-size: 3rem;
            font-weight: bold;
            margin-bottom: 8px;
            text-shadow: 2px 2px 4px rgba(0, 0, 0, 0.3);
            transition: all 0.5s ease;
        }

        .stop-info {
            font-size: 1.3rem;
            opacity: 0.9;
            margin-bottom: 8px;
            transition: all 0.5s ease;
        }

        .stop-code {
            font-size: 1rem;
            opacity: 0.7;
            font-family: monospace;
            transition: all 0.5s ease;
        }

        .cycling-indicator {
            position: absolute;
            top: 0;
            right: 0;
            display: flex;
            flex-direction: column;
            align-items: center;
            font-size: 0.9rem;
            opacity: 0.8;
        }

        .stop-counter {
            background: rgba(255, 255, 255, 0.2);
            padding: 8px 15px;
            border-radius: 20px;
            margin-bottom: 10px;
        }

        .cycle-progress {
            width: 120px;
            height: 6px;
            background: rgba(255, 255, 255, 0.2);
            border-radius: 3px;
            overflow: hidden;
        }

        .cycle-progress-bar {
            height: 100%;
            background: #4ade80;
            width: 0%;
            transition: width 0.3s ease;
            border-radius: 3px;
        }

        .departures {
            flex: 1;
            overflow-y: auto;
            opacity: 1;
            transition: opacity 0.3s ease;
        }

        .departures.fading {
            opacity: 0.3;
        }

        .departure-item {
            display: flex;
            align-items: center;
            justify-content: space-between;
            background: rgba(255, 255, 255, 0.1);
            margin-bottom: 15px;
            padding: 20px 25px;
            border-radius: 15px;
            backdrop-filter: blur(10px);
            box-shadow: 0 8px 32px rgba(0, 0, 0, 0.1);
            border: 1px solid rgba(255, 255, 255, 0.2);
            transition: all 0.3s ease;
            transform: translateX(0);
        }

        .departure-item:hover {
            transform: translateY(-2px);
            box-shadow: 0 12px 40px rgba(0, 0, 0, 0.2);
        }

        .departure-item.slide-in {
            animation: slideIn 0.5s ease forwards;
        }

        .departure-item.next-bus {
            border: 2px solid #4ade80;
            background: rgba(74, 222, 128, 0.1);
            box-shadow: 0 8px 32px rgba(74, 222, 128, 0.2);
        }

        @keyframes slideIn {
            from {
                transform: translateX(-100%);
                opacity: 0;
            }
            to {
                transform: translateX(0);
                opacity: 1;
            }
        }

        .route-info {
            display: flex;
            align-items: center;
            flex: 1;
        }

        .route-number {
            background: #ff6b35;
            color: white;
            padding: 12px 20px;
            border-radius: 50px;
            font-size: 1.8rem;
            font-weight: bold;
            margin-right: 20px;
            min-width: 70px;
            text-align: center;
            box-shadow: 0 4px 15px rgba(255, 107, 53, 0.3);
        }

        .route-number.next-bus {
            background: #4ade80;
            box-shadow: 0 4px 15px rgba(74, 222, 128, 0.4);
        }

        .destination {
            font-size: 1.6rem;
            font-weight: 500;
        }

        .time-info {
            text-align: right;
            display: flex;
            flex-direction: column;
            align-items: flex-end;
        }

        .departure-time {
            font-size: 2.2rem;
            font-weight: bold;
            color: #94a3b8;
            text-shadow: 0 2px 4px rgba(0, 0, 0, 0.3);
        }

        .departure-time.next-bus {
            color: #4ade80;
        }

        .time-remaining {
            font-size: 1.2rem;
            opacity: 0.8;
            margin-top: 5px;
        }

        .time-remaining.next-bus {
            color: #4ade80;
            font-weight: bold;
            font-size: 1.4rem;
        }

        .status {
            text-align: center;
            padding: 30px;
            font-size: 1.5rem;
        }

        .loading {
            color: #fbbf24;
        }

        .error {
            color: #ef4444;
        }

        .no-data {
            color: #94a3b8;
        }

        .footer {
            text-align: center;
            margin-top: 25px;
            padding-top: 15px;
            border-top: 2px solid rgba(255, 255, 255, 0.2);
            opacity: 0.7;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .last-updated {
            font-size: 1rem;
        }

        .next-stop-timer {
            font-size: 0.9rem;
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .refresh-indicator {
            display: inline-block;
            width: 12px;
            height: 12px;
            background: #4ade80;
            border-radius: 50%;
            margin-left: 10px;
            animation: pulse 2s infinite;
        }

        @keyframes pulse {
            0% { opacity: 1; }
            50% { opacity: 0.5; }
            100% { opacity: 1; }
        }

        .delayed {
            color: #fbbf24 !important;
        }

        .cancelled {
            color: #ef4444 !important;
            text-decoration: line-through;
        }

        .grange-road-title {
            font-size: 1.6rem;
            color: #4ade80;
            margin-bottom: 5px;
            font-weight: 300;
        }

        /* Responsive design for different TV sizes */
        @media (max-width: 1024px) {
            .stop-name { font-size: 2.5rem; }
            .next-bus-time { font-size: 3.2rem; }
            .route-number { font-size: 1.5rem; padding: 10px 18px; }
            .departure-time { font-size: 1.9rem; }
            .destination { font-size: 1.4rem; }
        }

        @media (max-width: 768px) {
            .stop-name { font-size: 2rem; }
            .next-bus-time { font-size: 2.5rem; }
            .route-number { font-size: 1.3rem; padding: 8px 15px; }
            .departure-time { font-size: 1.6rem; }
            .destination { font-size: 1.2rem; }
        }
    </style>
</head>
<body>
    <div class="container">
        <!-- Next Bus Banner -->
        <div class="next-bus-banner" id="nextBusBanner">
            <div class="next-bus-title">Next bus from The Infant Hercules</div>
            <div class="next-bus-time" id="nextBusTime">Loading...</div>
            <div class="next-bus-route" id="nextBusRoute">Checking schedules...</div>
        </div>

        <div class="header">
            <div class="grange-road-title">Cleveland Centre Bus Stops</div>
            <h1 class="stop-name" id="stopName">Loading...</h1>
            <div class="stop-info" id="stopInfo">Checking bus stops...</div>
            <div class="stop-code" id="stopCode">Stop ID: ---</div>

            <div class="cycling-indicator">
                <div class="stop-counter" id="stopCounter">Stop 1 of 3</div>
                <div class="cycle-progress">
                    <div class="cycle-progress-bar" id="progressBar"></div>
                </div>
            </div>
        </div>

        <div class="departures" id="departures">
            <div class="status loading">
                Initializing bus stops...
            </div>
        </div>

        <div class="footer">
            <div class="last-updated" id="lastUpdated">
                Starting up...
                <span class="refresh-indicator"></span>
            </div>
            <div class="next-stop-timer" id="nextStopTimer">
                Next stop in: <span id="countdown">15</span>s
            </div>
        </div>
    </div>

    <script>
        class ClevelandCentreBusDisplay {
            constructor() {
                // The three specific Cleveland Centre bus stops
                this.busStops = [
                    {
                        id: '079073279A',
                        name: 'Cleveland Centre (Stand O)',
                        info: 'Grange Road, near Albert Road',
                        direction: 'Buses point west ←'
                    },
                    {
                        id: '079073279B',
                        name: 'Cleveland Centre (Stand P)',
                        info: 'Grange Road, near Albert Road',
                        direction: 'Buses point west ←'
                    },
                    {
                        id: '079073279C',
                        name: 'Cleveland Centre (Stand Q)',
                        info: 'Grange Road, near Albert Road',
                        direction: 'Buses point west ←'
                    }
                ];

                this.currentStopIndex = 0;
                this.refreshInterval = 30000; // 30 seconds for data refresh
                this.cycleInterval = 15000; // 15 seconds per stop
                this.countdownInterval = null;
                this.refreshTimeout = null;
                this.allBusData = {}; // Store data for all stops

                // DOM elements
                this.nextBusTimeElement = document.getElementById('nextBusTime');
                this.nextBusRouteElement = document.getElementById('nextBusRoute');
                this.stopNameElement = document.getElementById('stopName');
                this.stopInfoElement = document.getElementById('stopInfo');
                this.stopCodeElement = document.getElementById('stopCode');
                this.stopCounterElement = document.getElementById('stopCounter');
                this.progressBarElement = document.getElementById('progressBar');
                this.departuresContainer = document.getElementById('departures');
                this.lastUpdatedElement = document.getElementById('lastUpdated');
                this.nextStopTimerElement = document.getElementById('nextStopTimer');
                this.countdownElement = document.getElementById('countdown');

                this.init();
            }

            init() {
                this.displayCurrentStop();
                this.fetchAllBusData();
                this.startCycling();
                this.startCountdown();
                
                // Refresh all data periodically
                setInterval(() => {
                    this.fetchAllBusData();
                }, this.refreshInterval);
            }

            async fetchAllBusData() {
                // Fetch data for all stops to find the next bus across all stops
                for (let i = 0; i < this.busStops.length; i++) {
                    const stop = this.busStops[i];
                    this.allBusData[stop.id] = await this.getMockBusDataForStop(stop);
                }
                
                this.updateNextBusBanner();
                this.displayBusTimesForCurrentStop();
                this.updateLastRefreshTime();
            }

            updateNextBusBanner() {
                // Find the next bus across all stops
                let nextBus = null;
                let earliestTime = null;

                Object.values(this.allBusData).forEach(stopData => {
                    if (stopData && stopData.length > 0) {
                        const firstBus = stopData[0]; // Buses are sorted by time
                        if (!earliestTime || firstBus.scheduledTime < earliestTime) {
                            earliestTime = firstBus.scheduledTime;
                            nextBus = firstBus;
                        }
                    }
                });

                if (nextBus) {
                    const timeRemaining = this.calculateTimeRemaining(nextBus.scheduledTime);
                    const minsOnly = timeRemaining.replace(' mins', '').replace(' min', '').replace('Due now', '0');
                    
                    // Special message for Phil when it's a 17A or 17B bus
                    if (nextBus.routeNumber === '17A' || nextBus.routeNumber === '17B') {
                        const mins = parseInt(minsOnly);
                        const leaveTime = Math.max(0, mins - 2); // Give Phil 2 minutes to get there
                        
                        if (leaveTime <= 0) {
                            this.nextBusTimeElement.textContent = 'Leave now!';
                            this.nextBusRouteElement.textContent = `Phil you need to leave now for the ${nextBus.routeNumber}`;
                        } else if (leaveTime === 1) {
                            this.nextBusTimeElement.textContent = '1 min';
                            this.nextBusRouteElement.textContent = `Phil you need to leave in 1 min`;
                        } else {
                            this.nextBusTimeElement.textContent = `${leaveTime} mins`;
                            this.nextBusRouteElement.textContent = `Phil you need to leave in ${leaveTime} mins`;
                        }
                    } else {
                        this.nextBusTimeElement.textContent = timeRemaining;
                        this.nextBusRouteElement.textContent = `Route ${nextBus.routeNumber} to ${nextBus.destination}`;
                    }
                } else {
                    this.nextBusTimeElement.textContent = 'No buses';
                    this.nextBusRouteElement.textContent = 'Check back later';
                }
            }

            displayCurrentStop() {
                const currentStop = this.busStops[this.currentStopIndex];
                
                this.stopNameElement.textContent = currentStop.name;
                this.stopInfoElement.textContent = `${currentStop.info} - ${currentStop.direction}`;
                this.stopCodeElement.textContent = `Stop ID: ${currentStop.id}`;
                this.stopCounterElement.textContent = `Stop ${this.currentStopIndex + 1} of ${this.busStops.length}`;

                // Update progress bar
                const progress = ((this.currentStopIndex + 1) / this.busStops.length) * 100;
                this.progressBarElement.style.width = `${progress}%`;
            }

            displayBusTimesForCurrentStop() {
                const currentStop = this.busStops[this.currentStopIndex];
                const busData = this.allBusData[currentStop.id];

                this.departuresContainer.classList.add('fading');
                
                setTimeout(() => {
                    this.displayBusTimes(busData);
                    this.departuresContainer.classList.remove('fading');
                    
                    // Add slide-in animation to new items
                    const items = this.departuresContainer.querySelectorAll('.departure-item');
                    items.forEach((item, index) => {
                        setTimeout(() => {
                            item.classList.add('slide-in');
                        }, index * 100);
                    });
                }, 300);
            }

            // Generate realistic mock data based on the actual stop services
            async getMockBusDataForStop(stop) {
                return new Promise(resolve => {
                    setTimeout(() => {
                        const now = new Date();
                        let buses = [];

                        // Generate different services for each stop based on real bustimes.org data
                        if (stop.id === '079073279A') {
                            // Stand O - typically services like 12, 5A, etc.
                            buses = this.generateBusesForStop(['12', '5A', '28', '23'], 
                                ['Coulby Newham', 'Bus Station', 'Guisborough', 'Redcar'], now);
                        } else if (stop.id === '079073279B') {
                            // Stand P - typically 17A, 17B services
                            buses = this.generateBusesForStop(['17A', '17B'], 
                                ['Ingleby Barwick', 'Stockton', 'Thornaby'], now);
                        } else if (stop.id === '079073279C') {
                            // Stand Q - typically 63, 29 services
                            buses = this.generateBusesForStop(['63', '29'], 
                                ['Redcar', 'Marton', 'New Marske'], now);
                        }

                        // Sort by scheduled time
                        buses.sort((a, b) => a.scheduledTime - b.scheduledTime);
                        resolve(buses);
                    }, 200 + Math.random() * 300);
                });
            }

            generateBusesForStop(routes, destinations, now) {
                const buses = [];
                const numBuses = 4 + Math.floor(Math.random() * 3);

                for (let i = 0; i < numBuses; i++) {
                    const route = routes[Math.floor(Math.random() * routes.length)];
                    const destination = destinations[Math.floor(Math.random() * destinations.length)];
                    const minutesAway = 2 + (i * 7) + Math.floor(Math.random() * 5);
                    const status = Math.random() > 0.85 ? 'delayed' : 'onTime';

                    buses.push({
                        routeNumber: route,
                        destination: destination,
                        scheduledTime: new Date(now.getTime() + minutesAway * 60000),
                        status: status
                    });
                }

                return buses;
            }

            displayBusTimes(buses) {
                if (!buses || buses.length === 0) {
                    this.departuresContainer.innerHTML = '<div class="status no-data">No upcoming departures</div>';
                    return;
                }

                // Find the next bus globally to highlight it
                let globalNextBus = null;
                let earliestTime = null;

                Object.values(this.allBusData).forEach(stopData => {
                    if (stopData && stopData.length > 0) {
                        const firstBus = stopData[0];
                        if (!earliestTime || firstBus.scheduledTime < earliestTime) {
                            earliestTime = firstBus.scheduledTime;
                            globalNextBus = firstBus;
                        }
                    }
                });

                const html = buses.map(bus => this.createBusItemHTML(bus, globalNextBus)).join('');
                this.departuresContainer.innerHTML = html;
            }

            createBusItemHTML(bus, globalNextBus) {
                const timeRemaining = this.calculateTimeRemaining(bus.scheduledTime);
                const timeString = bus.scheduledTime.toLocaleTimeString('en-GB', { 
                    hour: '2-digit', 
                    minute: '2-digit' 
                });

                const statusClass = bus.status === 'delayed' ? 'delayed' : 
                                   bus.status === 'cancelled' ? 'cancelled' : '';

                // Check if this is the next bus globally
                const isNextBus = globalNextBus && 
                    bus.routeNumber === globalNextBus.routeNumber &&
                    bus.destination === globalNextBus.destination &&
                    Math.abs(bus.scheduledTime - globalNextBus.scheduledTime) < 1000;

                const nextBusClass = isNextBus ? 'next-bus' : '';

                return `
                    <div class="departure-item ${nextBusClass}">
                        <div class="route-info">
                            <div class="route-number ${nextBusClass}">${bus.routeNumber}</div>
                            <div class="destination">${bus.destination}</div>
                        </div>
                        <div class="time-info">
                            <div class="departure-time ${statusClass} ${nextBusClass}">${timeString}</div>
                            <div class="time-remaining ${nextBusClass}">${timeRemaining}</div>
                        </div>
                    </div>
                `;
            }

            calculateTimeRemaining(scheduledTime) {
                const now = new Date();
                const diffMs = scheduledTime - now;
                const diffMins = Math.round(diffMs / 60000);

                if (diffMins < 1) return 'Due now';
                if (diffMins === 1) return '1 min';
                return `${diffMins} mins`;
            }

            startCycling() {
                setInterval(() => {
                    this.nextStop();
                }, this.cycleInterval);
            }

            nextStop() {
                this.currentStopIndex = (this.currentStopIndex + 1) % this.busStops.length;
                this.displayCurrentStop();
                this.displayBusTimesForCurrentStop();
                this.resetCountdown();
            }

            startCountdown() {
                let seconds = this.cycleInterval / 1000;
                this.countdownElement.textContent = seconds;

                this.countdownInterval = setInterval(() => {
                    seconds--;
                    this.countdownElement.textContent = seconds;
                    
                    if (seconds <= 0) {
                        seconds = this.cycleInterval / 1000;
                    }
                }, 1000);
            }

            resetCountdown() {
                const seconds = this.cycleInterval / 1000;
                this.countdownElement.textContent = seconds;
            }

            updateLastRefreshTime() {
                const now = new Date();
                const timeString = now.toLocaleTimeString('en-GB');
                this.lastUpdatedElement.innerHTML = `
                    Last updated: ${timeString}
                    <span class="refresh-indicator"></span>
                `;
            }
        }

        // Initialize the display when the page loads
        document.addEventListener('DOMContentLoaded', () => {
            new ClevelandCentreBusDisplay();
        });

        // Handle visibility changes to refresh when tab becomes active
        document.addEventListener('visibilitychange', () => {
            if (!document.hidden) {
                location.reload();
            }
        });
    </script>
</body>
</html>